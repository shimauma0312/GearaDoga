# MT5スキャルピング自動売買ツール運用ガイド

このドキュメントでは、PythonとMT5を使用したスキャルピング自動売買ツールの設定方法と運用手順について説明します。

## 目次

1. [Pythonのインストール](#Pythonのインストール)
2. [前提条件](#前提条件)
3. [インストール手順](#インストール手順)
4. [設定方法](#設定方法)
5. [起動方法](#起動方法)
6. [運用方法](#運用方法)
7. [ログの確認](#ログの確認)
8. [モデルの再学習](#モデルの再学習)
9. [トラブルシューティング](#トラブルシューティング)

## Pythonのインストール

このツールを実行するにはPython 3.8以上が必要です。Pythonがインストールされていない場合は、以下の手順でインストールしてください。

### Windowsの場合

1. [Python公式サイト](https://www.python.org/downloads/) にアクセスし、最新のPython 3.8以上をダウンロードします。
2. インストーラーを実行し、**"Add Python to PATH"** にチェックを入れてから **"Install Now"** をクリックします。
3. インストールが完了したら、以下のコマンドを実行して正しくインストールされているか確認します。

```bash
python --version
```

### Macの場合

1. ターミナルを開き、以下のコマンドを実行してHomebrewがインストールされているか確認します。

```bash
brew --version
```

2. Homebrewがインストールされていない場合は、以下のコマンドを実行してインストールします。

```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

3. Pythonをインストールします。

```bash
brew install python
```

4. インストールが完了したら、以下のコマンドを実行して正しくインストールされているか確認します。

```bash
python3 --version
```

## 前提条件

- Python 3.8以上がインストールされていること
- MetaTrader 5がインストールされていること
- トレーディングアカウントが設定済みであること

## インストール手順

1. 必要なPythonパッケージをインストールします：

```bash
pip install numpy pandas scikit-learn python-dotenv schedule MetaTrader5
```

2. リポジトリをクローンまたはスクリプトをダウンロードします：

```bash
git clone https://github.com/shimauma0312/GearaDoga.git
cd GearaDoga
```

3. `.env`ファイルをテンプレートからコピーして作成します：

```bash
cp .env.example .env
```

## 設定方法

`.env`ファイルを編集して、以下の設定を行います：

### MT5接続設定

```
MT5_ACCOUNT=12345678       # MT5のアカウント番号
MT5_PASSWORD=your_password # MT5のパスワード
MT5_SERVER=your_broker     # MT5のサーバー名
```

### 取引設定

```
TRADING_SYMBOL=USDJPY      # 取引通貨ペア
TIMEFRAME=TIMEFRAME_M5     # タイムフレーム（M1, M5, M15, M30, H1, H4, D1）
LOT_SIZE=0.01              # 取引ロットサイズ
STOP_LOSS_PIPS=20          # ストップロス（pips）
TAKE_PROFIT_PIPS=30        # テイクプロフィット（pips）
```

## 起動方法

MetaTrader 5を起動し、ログインした状態で以下のコマンドを実行します：

```bash
python trading_bot.py
```

初回起動時には、機械学習モデルのトレーニングが自動的に実行されます。これには数分かかる場合があります。

## 運用方法

このボットは以下のような動作をします：

1. **起動時**：
   - MT5に接続
   - モデルがない場合は新規トレーニング
   - モデルがある場合は読み込み

2. **定期的な処理**：
   - 1分ごとに市場状態を分析
   - 予測結果に基づいて取引を実行
   - 毎週日曜日の深夜2時に自動的にモデルを再学習

## ログの確認

ログファイルは`logs`ディレクトリに日付別に保存されます。以下のコマンドで最新のログを確認できます：

```bash
tail -f logs/trading_YYYYMMDD.log
```

## モデルの再学習

モデルは以下のタイミングで自動的に再学習されます：
- 初回起動時（モデルが存在しない場合）
- スケジュールされた再学習時間（デフォルトでは毎週日曜日の深夜2時）

手動で再学習を行いたい場合は、`models`ディレクトリ内のファイルを削除して再起動するか、プログラムを修正して再学習用の関数を呼び出します。

## トラブルシューティング

### MT5に接続できない
- MT5が起動しているか確認
- アカウント情報が正しいか確認
- サーバー名が正しいか確認

### モデルのトレーニングでエラーが発生する
- 十分なデータがあるか確認
- メモリ不足でない場合は`TRAINING_PERIODS`を減らしてみる

### 取引が実行されない
- 市場が開いているか確認
- 予測の確信度が低すぎないか確認
- ログで詳細なエラーメッセージを確認

### その他の問題
- ログファイルを確認し、エラーメッセージを特定
- Pythonのバージョンを確認（3.8以上が必要）
- 必要なライブラリがすべてインストールされているか確認

