# MT5スキャルピング自動売買ツール運用ガイド

このドキュメントでは、PythonとMT5を使用したスキャルピング自動売買ツールの設定方法と運用手順について説明します。

## 目次

1. [前提条件](#前提条件)
2. [インストール手順](#インストール手順)
3. [設定方法](#設定方法)
4. [起動方法](#起動方法)
5. [運用方法](#運用方法)
6. [ログの確認](#ログの確認)
7. [モデルの再学習](#モデルの再学習)
8. [トラブルシューティング](#トラブルシューティング)

## 前提条件

- Python 3.8以上がインストールされていること
- MetaTrader 5がインストールされていること
- トレーディングアカウントが設定済みであること

## インストール手順

1. 必要なPythonパッケージをインストールします：

```bash
pip install numpy pandas scikit-learn python-dotenv schedule MetaTrader5
```

2. リポジトリをクローンまたはスクリプトをダウンロードします：

```bash
git clone https://github.com/your-username/mt5-scalping-bot.git
cd mt5-scalping-bot
```

3. `.env`ファイルをテンプレートからコピーして作成します：

```bash
cp .env.template .env
```

## 設定方法

`.env`ファイルを編集して、以下の設定を行います：

### MT5接続設定

```
MT5_ACCOUNT=12345678       # MT5のアカウント番号
MT5_PASSWORD=your_password # MT5のパスワード
MT5_SERVER=your_broker     # MT5のサーバー名
```

### 取引設定

```
TRADING_SYMBOL=USDJPY      # 取引通貨ペア
TIMEFRAME=TIMEFRAME_M5     # タイムフレーム（M1, M5, M15, M30, H1, H4, D1）
LOT_SIZE=0.01              # 取引ロットサイズ
STOP_LOSS_PIPS=20          # ストップロス（pips）
TAKE_PROFIT_PIPS=30        # テイクプロフィット（pips）
```

### モデル設定

```
MODEL_PATH=models/trading_model.pkl  # モデルの保存先
SCALER_PATH=models/scaler.pkl        # スケーラーの保存先
TRAINING_PERIODS=5000               # 学習に使用するローソク足の数
RETRAIN_DAYS=7                      # 再学習の間隔（日数）
```

## 起動方法

MetaTrader 5を起動し、ログインした状態で以下のコマンドを実行します：

```bash
python trading_bot.py
```

初回起動時には、機械学習モデルのトレーニングが自動的に実行されます。これには数分かかる場合があります。

## 運用方法

このボットは以下のような動作をします：

1. **起動時**：
   - MT5に接続
   - モデルがない場合は新規トレーニング
   - モデルがある場合は読み込み

2. **定期的な処理**：
   - 5分ごとに市場状態を分析
   - 予測結果に基づいて取引を実行
   - 毎週日曜日の深夜2時に自動的にモデルを再学習

3. **取引ロジック**：
   - 機械学習モデルが上昇/下降/横ばいを予測
   - 予測の確信度（確率）が閾値を超えた場合のみ取引
   - 一度に持つポジション数に制限あり

## ログの確認

ログファイルは`logs`ディレクトリに日付別に保存されます。以下のコマンドで最新のログを確認できます：

```bash
tail -f logs/trading_YYYYMMDD.log
```

ログには以下の情報が含まれます：
- 接続情報
- モデルのトレーニング状況
- 予測結果と確率
- 取引の実行結果
- エラーメッセージ（発生した場合）

## モデルの再学習

モデルは以下のタイミングで自動的に再学習されます：
- 初回起動時（モデルが存在しない場合）
- スケジュールされた再学習時間（デフォルトでは毎週日曜日の深夜2時）

手動で再学習を行いたい場合は、`models`ディレクトリ内のファイルを削除して再起動するか、プログラムを修正して再学習用の関数を呼び出します。

## トラブルシューティング

### MT5に接続できない
- MT5が起動しているか確認
- アカウント情報が正しいか確認
- サーバー名が正しいか確認

### モデルのトレーニングでエラーが発生する
- 十分なデータがあるか確認
- メモリ不足でない場合は`TRAINING_PERIODS`を減らしてみる

### 取引が実行されない
- 市場が開いているか確認
- 予測の確信度が低すぎないか確認
- ログで詳細なエラーメッセージを確認

### その他の問題
- ログファイルを確認し、エラーメッセージを特定
- Pythonのバージョンを確認（3.8以上が必要）
- 必要なライブラリがすべてインストールされているか確認